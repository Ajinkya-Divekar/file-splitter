<div *ngIf="isLoading" class="loading-overlay">
  <p>ğŸ”„ Processing documents... Please wait.</p>
</div>

<div class="pdf-container">
  <pdf-viewer
    class="pdf-viewer"
    [hidden]="!pdfLoaded"
    [src]="pdfSrc"
    [zoom]="0.75"
    [page]="1"
    [show-all]="false"
    [original-size]="true"
    [render-text]="false"
    (after-load-complete)="onPdfLoadComplete($event)"
    style="width: 1px; height: 1px; opacity: 0.01"
  ></pdf-viewer>

  <div class="split-layout" *ngIf="pdfLoaded">
    <div class="meta-panel">
      <div
        *ngFor="let section of tempSections; let i = index"
        class="meta-item"
        (click)="toggleSection(i)"
      >
        <div class="meta-header">
          <ng-container *ngIf="editingIndex !== i">
            <span class="meta-title"> {{ section.name }} </span>
            <span class="meta-edit" (click)="enableEdit(i, $event)">âœï¸</span>
          </ng-container>

          <ng-container *ngIf="editingIndex === i">
            <input
              [(ngModel)]="resSections[i].name"
              (click)="$event.stopPropagation()"
              (keydown.enter)="disableEdit()"
              class="meta-input"
            />
            <button class="meta-confirm" (click)="disableEdit()">âœ…</button>
          </ng-container>
        </div>

        <div *ngIf="isExpanded(i)" class="meta-details">
          Page: {{ section.start }}<span *ngIf="section.end">
            - {{ section.end }}</span
          >
        </div>
      </div>
    </div>

    <!-- ğŸ“„ RIGHT: PDF strip -->
    <div class="pdf-strip-wrapper">
      <!-- ğŸ” Minimal Zoom Slider -->
      <div class="zoom-controls">
        <button (click)="adjustZoom(-0.1)">âˆ’</button>
        <input
          type="range"
          [min]="0.25"
          [max]="0.95"
          [step]="0.05"
          [(ngModel)]="zoomLevel"
        />
        <button (click)="adjustZoom(0.1)">ï¼‹</button>
      </div>

      <div class="pdf-strip" #pdfStrip>
        <div
          *ngFor="let line of splitLines; let i = index"
          class="drag-line"
          [ngStyle]="{ transform: 'translateX(' + line.x + 'px)' }"
          cdkDrag
          [cdkDragLockAxis]="'x'"
          (cdkDragStarted)="onDragStart(i)"
          (cdkDragEnded)="onDragEnd($event, i)"
        ></div>

        <ng-container *ngFor="let page of pages; let i = index">
          <div class="snap-target debug" #snapTarget></div>
          <div class="pdf-box">
            <div
              style="
                text-align: center;
                font-size: 0.9rem;
                color: #629beb;
                margin-top: 10px;
              "
            >
              {{ page }}
            </div>
            <pdf-viewer
              [src]="pdfSrc"
              [zoom]="zoomLevel"
              [page]="page"
              [show-all]="false"
              [original-size]="false"
              [render-text]="true"
              [ngStyle]="{
      width: '300px',
      height: '400px',
      'margin-top': getZoomMarginPercent(zoomLevel)
    }"
            ></pdf-viewer>
          </div>
        </ng-container>

        <div class="snap-target debug" #snapTarget></div>
      </div>
    </div>
  </div>
  <div class="split-actions">
    <button class="action-btn left" (click)="onSaveSplit()">
      ğŸ’¾ Save New Split
    </button>
    <button class="action-btn right">â¬‡ï¸ Download Split Files</button>
  </div>
</div>
